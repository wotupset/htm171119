<html><head>
<title>http</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  
<script>
/*
slim版本的jquery 沒有get功能
*/
document.addEventListener("DOMContentLoaded", function(event) { 
	console.log( 'DOMContentLoaded' );
  //
});

(function() {
  console.log( 'IIFE 立即函式' );
  //
})();
//document.body.appendChild(document.createElement("script")).src = url;



//jquery
try{
  //adddlert("Welcome guest!");
  $(document).ready(function() {
  
  	//console.log( jQuery.fn.jquery);
  	//console.log( $.prototype.jquery);
  	console.log( $().jquery ); //3.2.1
	

    //全域變數//global
	time = new Date();
	gg=[];
	gg['poi']='123';
	gg.ypa='456';
    //
	//loadDoc('171025.htm');
	//
    poi(); //
    //poi2('2017/'); //
	pya();
  });
  //throw "is empty";
  
}
catch(err){
  	console.log( ''+err.message );
}
finally {
    console.log( 'try-catch-finally' );
}



//
function poi() {
	//
	$('body').append('<div id="box"></div>');
	$('div#box').append('<div id="box_year">box_year<br/></div>');
	$('div#box').append('<div id="box_month">box_month<br/></div>');
	$('div#box').append('<div id="box_day">box_day<br/></div>');
	//
	$('div#box_year').append('<button type="button" qwq="2017">2017</button>');
	$('div#box_year').append('<button type="button" qwq="2018">2018</button>');

	
	//
	var tmp='';
	for(var i=1;i<=12;i++){
		tmp='';
		tmp=tmp+i;
		if(i<10){tmp='0'+tmp;}
		tmp=tmp+'/';
	    var x=poi2('2017/'+tmp); //
		//console.log(x);

	}
	//

	//
}

function poi1() {
	var jqxhr = $.get('2017/12/',{name:"poi",time:1230},function(response,status,xhr){
		//console.log('$.get');
		//console.log( this );
		//console.log( response ); //<html><body>
		//console.log( status ); //success
		//console.log( xhr ); //xhr.status=200 xhr.readyState=4 xhr.responseText=<html><body>
	//function(a,b,c){console.log(a,b,c);}
	},"text");
	jqxhr.done(function(response,status,xhr){
		console.log('jqxhr.done');
		console.log(xhr,response,status)
	});
	jqxhr.fail(function(response,status,xhr){
		console.log('jqxhr.fail');
		console.log(response,status,xhr)
	});
	jqxhr.always(function(response,status,xhr){
		console.log('jqxhr.always');
		console.log(response,status,xhr)
	});
	
}

function poi2(x){
	var getfile=x;
	var jqxhr = $.get(getfile,{},function(){},"text");
	jqxhr.done(function(){
		//console.log('jqxhr.done');
		$('div#box_month').append('<button type="button" qwq="open">'+getfile+'</button>');
		$("div#box_month > button").on('click', function() {
			console.log( $(this).text() );
		});
	});
	jqxhr.fail(function(){
		//console.log('jqxhr.fail');
	});
	jqxhr.always(function(){
		//console.log('jqxhr.always');
	});
}

function pya(){
var url='2017/';

var xhr = new XMLHttpRequest();
//必須在呼叫 open() 方法開啟請求連線之前就註冊好事件監聽器
//xhr.addEventListener("progress", function(event){console.log(event);});
//xhr.addEventListener("loadend", function(e){console.log(e);});
//下面三種狀況 會觸發上面這行
//xhr.addEventListener("load", function(event){console.log(event);});
//xhr.addEventListener("error", function(event){console.log(event);});
//xhr.addEventListener("abort", function(event){console.log(event);});
xhr.open('GET', url, 1);//0=同步式請求 等待取得後才繼續
// `false` makes the request synchronous
/*
xhr.readyState
0: 请求未初始化
1: 服务器连接已建立
2: 请求已接收
3: 请求处理中
4: 请求已完成，且响应已就绪
*/
xhr.onreadystatechange = function(e){
  console.log('onreadystatechange'+xhr.readyState);
  //console.log(this);//xhr
  if (xhr.readyState === 4) {
    if (xhr.status === 200) {
      //console.error(xhr.responseText);
      //console.log(this);
	  //.getResponseHeader("Last-Modified")
		var headers = xhr.getAllResponseHeaders().toLowerCase();
		console.log( headers );
		console.log( xhr.getResponseHeader("Server") );//個別header
    } else {
      //console.error(xhr.statusText);
    }
  }
};
xhr.onload = function (e) {
  console.log('onload');
  //console.log(e); //與上方progress 相同
  if (xhr.readyState === 4) {
    if (xhr.status === 200) {
      //console.error(xhr.responseText);
      //console.log(this);
	  //.getResponseHeader("Last-Modified")
    } else {
      //console.error(xhr.statusText);
    }
  }
};
xhr.onerror = function (e) {
  console.log('onerror');
  console.error(xhr.statusText);
  
};
xhr.ontimeout = function (e) {
  console.log('ontimeout');
  console.error(e);
};
xhr.send(null);
//console.log( document.location );
//alert(headers);
//console.log( 0.1+0.2 );
//console.log( (1+2)/10 );


}


function loadDoc(x){//純js
	var getfile=x;
	//
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			console.log( this );
			console.log( this.readyState );
			console.log( this.status );
		
			//document.getElementById("ddd").innerHTML = this.responseText;
			//poi2();
		}else{
			//document.getElementById("ddd").innerHTML = this.status;
		}
	};
	
	xhttp.open("GET", getfile);
	xhttp.send();
}

</script>
<STYLE>
</STYLE>

</head>
<body bgcolor="#FFFFEE" text="#800000" link="#0000EE" vlink="#0000EE">



</body></html>